import{r as o,b as D,j as e,V as l,E as v,ag as I,e as C,B as b,as as S,X as A,Y as p,at as E,au as T,P as M}from"./index-CbfT30fd.js";import{M as F,a as O,L as r}from"./ClientRoutes-BCc3jrqm.js";import{t as k}from"./lottie-Cspzgxa9.js";import{b as y}from"./Modal-C0BpvVRR.js";import{S as U}from"./Spinner-DMmn0Gbb.js";import"./CloseButton-Dj7i9u33.js";const L=()=>{const[s,h]=o.useState(null),[n,i]=o.useState(!1),[m,c]=o.useState(!1),[t,x]=o.useState({}),f=D();o.useEffect(()=>{(async()=>{try{const g=await C.get("/api/user-by-id");h(g.data)}catch(g){b.error(g.response.data.message),g.response.status===401&&f(g.response.data.redirect)}})()},[]);const N=()=>{i(!0),x({name:s.name,email:s.email,mobileNumber:s.mobileNumber})},a=async()=>{try{await C.delete("/api/delete-user"),b.info("User deleted successfully"),localStorage.clear(),f("/")}catch(d){console.error(d)}c(!1)},u=async()=>{try{await C.put("/api/update-user",t),b.success("User updated successfully"),h({...s,...t}),i(!1)}catch(d){console.error(d),b.error("User updated failed")}},j=d=>{x({...t,[d.target.name]:d.target.value})};return e.jsxs("div",{className:"container mt-5 ",children:[s?e.jsx(l,{style:{border:"none"},children:e.jsxs(l.Body,{className:"d-flex flex-column flex-lg-row justify-content-between align-items-center",children:[n?e.jsx("div",{className:"container align-item-center",children:e.jsxs("div",{className:"row mb-3",children:[e.jsx("div",{className:"col-md-4",children:e.jsx(l.Text,{children:e.jsx(k.Control,{type:"text",name:"name",value:t.name,onChange:j,placeholder:"Name"})})}),e.jsx("div",{className:"col-md-4",children:e.jsx(l.Text,{children:n?e.jsx(k.Control,{type:"email",name:"email",value:t.email,onChange:j,placeholder:"Email"}):e.jsx(e.Fragment,{})})}),e.jsx("div",{className:"col-md-4",children:e.jsx(l.Text,{children:n?e.jsx(k.Control,{type:"text",name:"mobileNumber",value:t.mobileNumber,onChange:j,placeholder:"Mobile Number"}):e.jsx(e.Fragment,{})})})]})}):e.jsx("div",{children:e.jsx("h5",{children:e.jsxs("strong",{children:["Welcome ",s.name]})})}),e.jsxs("div",{className:"p-2",children:[!n&&e.jsx(v,{style:{width:"2.6rem",height:"2.4rem"},variant:"primary",onClick:N,className:"mx-2",children:e.jsx(I,{})}),e.jsx(v,{variant:"danger",style:{width:"2.6rem",height:"2.4rem"},onClick:()=>c(!0),className:"mx-2",children:e.jsx(F,{})})]})]})}):e.jsx("p",{children:"Loading..."}),e.jsxs(y,{show:m,onHide:()=>c(!1),children:[e.jsx(y.Header,{closeButton:!0,children:e.jsx(y.Title,{children:"Confirm Delete"})}),e.jsx(y.Body,{children:"Are you sure you want to delete this user?"}),e.jsxs(y.Footer,{children:[e.jsx(v,{variant:"secondary",onClick:()=>c(!1),children:e.jsx(O,{})}),e.jsx(v,{variant:"danger",onClick:a,children:e.jsx(F,{})})]})]}),n&&e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(v,{variant:"success",onClick:u,children:"Save"})})]})},H=({order:s})=>{const{serviceDetails:h,amount:n,currency:i,status:m}=s,c=D(),t=()=>{c("/mobile-recharge")};return e.jsxs(l,{className:"p-3 my-3 shadow-sm",children:[e.jsxs(l.Header,{as:"h5",className:"text-center",children:[e.jsx(S,{className:"me-2"})," Recharge"]}),e.jsxs(l.Body,{children:[e.jsxs(A,{children:[e.jsx(p,{md:6,children:e.jsx(r,{variant:"flush",children:e.jsxs(r.Item,{children:[e.jsx("strong",{children:"Number:"})," ",h.number]})})}),e.jsx(p,{md:6,children:e.jsx(r,{variant:"flush",children:e.jsxs(r.Item,{children:[e.jsx("strong",{children:"Amount:"})," ",n," ",i,m==="paid"?e.jsx(E,{className:"text-success ms-2"}):e.jsx(T,{className:"text-danger ms-2"})]})})})]}),e.jsx("hr",{}),e.jsx("div",{className:"text-center",children:e.jsx(v,{variant:"primary",onClick:t,children:"Recharge Again"})})]})]})},P=({order:s})=>{const h=D(),[n,i]=o.useState(""),[m,c]=o.useState(!0);o.useEffect(()=>{var R;if((R=s==null?void 0:s.serviceResponse)!=null&&R.Booking_RefNo)i(s.serviceResponse.Booking_RefNo),c(!1);else{const w=setInterval(()=>{var B;(B=s==null?void 0:s.serviceResponse)!=null&&B.Booking_RefNo&&(i(s.serviceResponse.Booking_RefNo),c(!1),clearInterval(w))},500);return()=>clearInterval(w)}},[s]);const t=()=>{h("/flights")};if(!s)return e.jsx("div",{children:"No order data available"});const{serviceDetails:x,amount:f,currency:N,status:a}=s,{flightDetails:u}=x||{},{Origin:j,Destination:d,TravelDate:g}=u||{};return e.jsxs(l,{className:"p-3 my-3 shadow-sm",children:[e.jsxs(l.Header,{as:"h5",className:"text-center",children:[e.jsx(M,{className:"me-2"})," Flight Details"]}),e.jsx(l.Body,{children:e.jsxs(A,{children:[e.jsx(p,{md:6,children:e.jsxs(r,{variant:"flush",children:[e.jsxs(r.Item,{children:[e.jsx("strong",{children:"Origin:"})," ",(j==null?void 0:j.AIRPORTCODE)||"N/A"]}),e.jsxs(r.Item,{children:[e.jsx("strong",{children:"Destination:"})," ",(d==null?void 0:d.AIRPORTCODE)||"N/A"]}),e.jsxs(r.Item,{children:[e.jsx("strong",{children:"Travel Date:"})," ",g?new Date(g).toLocaleDateString():"N/A"]})]})}),e.jsx(p,{md:6,children:e.jsxs(r,{variant:"flush",children:[e.jsxs(r.Item,{children:[e.jsx("strong",{children:"Total Amount:"})," ",N?`${N} ${f}`:"N/A"]}),e.jsxs(r.Item,{children:[e.jsx("strong",{children:"Booking Reference No:"}),m?e.jsx(U,{animation:"border",size:"sm",className:"ms-2"}):e.jsx("span",{className:"ms-2",children:n||"N/A"})]})]})})]})}),e.jsx(l.Footer,{className:"text-center",children:e.jsx(v,{variant:"primary",onClick:t,children:"Book Again"})})]})},_=({order:s})=>{if(!s)return e.jsx("div",{children:"No order data available"});const{serviceDetails:h,amount:n,currency:i,status:m}=s,{sourceName:c,destinationName:t,doj:x,seats:f}=h||{},{passengername:N,seatname:a}=f[0]||{},u=D(),j=()=>{u("/bus")};return e.jsxs(l,{className:"p-3 my-3 shadow-sm",children:[e.jsx(l.Header,{as:"h5",className:"text-center",children:"Bus Ticket Details"}),e.jsx(l.Body,{children:e.jsxs(A,{children:[e.jsx(p,{md:6,children:e.jsxs(r,{variant:"flush",children:[e.jsxs(r.Item,{children:[e.jsx("strong",{children:"From:"})," ",c||"N/A"]}),e.jsxs(r.Item,{children:[e.jsx("strong",{children:"To:"})," ",t||"N/A"]}),e.jsxs(r.Item,{children:[e.jsx("strong",{children:"Date of Journey:"})," ",x?new Date(x).toLocaleDateString():"N/A"]})]})}),e.jsx(p,{md:6,children:e.jsxs(r,{variant:"flush",children:[e.jsxs(r.Item,{children:[e.jsx("strong",{children:"Passenger Name:"})," ",N||"N/A"]}),e.jsxs(r.Item,{children:[e.jsx("strong",{children:"Seat Number:"})," ",a||"N/A"]}),e.jsxs(r.Item,{children:[e.jsx("strong",{children:"Total Amount:"})," ",i?`${i} ${n}`:"N/A"]})]})})]})}),e.jsx(l.Footer,{className:"text-center",children:e.jsx(v,{variant:"primary",onClick:j,children:"Book Again"})})]})},$=({order:s})=>{const{serviceType:h,serviceDetails:n,amount:i,currency:m,status:c}=s,t=()=>{switch(h){case"bookbus":return e.jsx(e.Fragment,{children:e.jsx(_,{order:s})});case"recharge":return e.jsx(e.Fragment,{children:e.jsx(H,{order:s})});case"bookflight":return e.jsx(e.Fragment,{children:e.jsx(P,{order:s})});default:return e.jsx(e.Fragment,{})}};return e.jsx(e.Fragment,{children:t()})},Y=()=>{const[s,h]=o.useState([]),[n,i]=o.useState([]),[m,c]=o.useState(!0),t=o.useRef(null),x=20,f=async()=>{try{const a=await C.get("/api/dashboard/orders");h(a.data.orders),i(a.data.orders.slice(0,x)),a.data.orders.length<=x&&c(!1)}catch(a){console.error(a.response.data.message)}};o.useEffect(()=>{f()},[]);const N=()=>{n.length<s.length?i(a=>[...a,...s.slice(a.length,a.length+x)]):c(!1)};return o.useEffect(()=>{const a=()=>{const{scrollTop:j,clientHeight:d,scrollHeight:g}=t.current;j+d>=g&&m&&N()},u=t.current;return u&&u.addEventListener("scroll",a),()=>u&&u.removeEventListener("scroll",a)},[n,s,m]),e.jsxs("div",{className:"container  mt-4",children:[e.jsx("h4",{className:"m-2",children:"Orders"}),e.jsxs("div",{ref:t,style:{height:"calc(100vh - 80px)",overflowY:"auto"},className:"scroll-container",children:[n.length>0?n.map(a=>e.jsx($,{order:a},a.orderId)):e.jsx("p",{children:"No orders available"}),m&&e.jsx("h4",{children:"Loading more orders..."})]})]})},q=()=>e.jsxs("div",{children:[e.jsx(L,{}),e.jsx(Y,{})]});export{q as default};
